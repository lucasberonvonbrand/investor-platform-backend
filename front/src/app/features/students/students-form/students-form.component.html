<p-toast></p-toast>

<div class="min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center p-4">
  <div class="max-w-4xl w-full">
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 md:p-8">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">Registro de Estudiante</h1>
        <p class="text-gray-500 dark:text-gray-400">Crea tu cuenta para empezar a publicar tus proyectos.</p>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

          <!-- Sección de Cuenta -->
          <div class="md:col-span-2">
            <h3 class="text-lg font-semibold border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">Datos de la Cuenta</h3>
          </div>

          <div class="field">
            <label for="username" class="font-medium flex items-center gap-2">
              <span>Nombre de Usuario <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Elige un nombre de usuario único para identificarte en la plataforma."></i>
            </label>
            <input id="username" type="text" pInputText formControlName="username" class="w-full mt-1" autocomplete="off" />
            <small *ngIf="isInvalidField('username') || form.get('username')?.pending" class="p-error">{{ form.get('username')?.pending ? 'Comprobando disponibilidad...' : getFieldError('username') }}</small>
          </div>

          <div class="field">
            <label for="password" class="font-medium flex items-center gap-2">
              <span>Contraseña <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Debe tener al menos 6 caracteres. Combina letras y números para mayor seguridad."></i>
            </label>
            <input id="password" type="password" pInputText formControlName="password" class="w-full mt-1" autocomplete="new-password" />
            <small *ngIf="isInvalidField('password')" class="p-error">{{ getFieldError('password') }}</small>
          </div>

          <div class="field">
            <label for="email" class="font-medium flex items-center gap-2">
              <span>Email <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Usa tu email institucional si es posible. Aquí recibirás notificaciones importantes."></i>
            </label>
            <input id="email" type="email" pInputText formControlName="email" class="w-full mt-1" />
            <small *ngIf="isInvalidField('email') || form.get('email')?.pending" class="p-error">{{ form.get('email')?.pending ? 'Comprobando disponibilidad...' : getFieldError('email') }}</small>
          </div>

          <!-- Sección de Datos Personales -->
          <div class="md:col-span-2 mt-4">
            <h3 class="text-lg font-semibold border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">Datos Personales</h3>
          </div>

          <div class="field">
            <label for="firstName" class="font-medium flex items-center gap-2">
              <span>Nombre <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Tu nombre de pila."></i>
            </label>
            <input id="firstName" type="text" pInputText formControlName="firstName" class="w-full mt-1" />
            <small *ngIf="isInvalidField('firstName')" class="p-error">{{ getFieldError('firstName') }}</small>
          </div>

          <div class="field">
            <label for="lastName" class="font-medium flex items-center gap-2">
              <span>Apellido <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Tu apellido."></i>
            </label>
            <input id="lastName" type="text" pInputText formControlName="lastName" class="w-full mt-1" />
            <small *ngIf="isInvalidField('lastName')" class="p-error">{{ getFieldError('lastName') }}</small>
          </div>

          <div class="field">
            <label for="dni" class="font-medium flex items-center gap-2">
              <span>DNI <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Tu Documento Nacional de Identidad (8 dígitos, sin puntos)."></i>
            </label>
            <input id="dni" type="text" pInputText formControlName="dni" class="w-full mt-1" pKeyFilter="int" maxlength="20" />
            <small *ngIf="isInvalidField('dni') || form.get('dni')?.pending" class="p-error">{{ form.get('dni')?.pending ? 'Comprobando DNI...' : getFieldError('dni') }}</small>
          </div>

          <div class="field">
            <label for="phone" class="font-medium flex items-center gap-2">
              <span>Teléfono <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Un número de teléfono de contacto directo."></i>
            </label>
            <input id="phone" type="text" pInputText formControlName="phone" class="w-full mt-1" />
            <small *ngIf="isInvalidField('phone')" class="p-error">{{ getFieldError('phone') }}</small>
          </div>

          <div class="field">
            <label for="dateOfBirth" class="font-medium flex items-center gap-2">
              <span>Fecha de Nacimiento <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Tu fecha de nacimiento."></i>
            </label>
            <input id="dateOfBirth" type="date" pInputText formControlName="dateOfBirth" class="w-full mt-1" />
            <small *ngIf="isInvalidField('dateOfBirth')" class="p-error">{{ getFieldError('dateOfBirth') }}</small>
          </div>

          <div class="field">
            <label for="linkedinUrl" class="font-medium flex items-center gap-2">
              <span>URL de LinkedIn</span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Tu perfil de LinkedIn (opcional). Ayuda a los inversores a conocerte mejor."></i>
            </label>
            <input id="linkedinUrl" type="text" pInputText formControlName="linkedinUrl" class="w-full mt-1" placeholder="https://www.linkedin.com/in/tu-perfil" />
            <small *ngIf="isInvalidField('linkedinUrl')" class="p-error">{{ getFieldError('linkedinUrl') }}</small>
          </div>

          <div class="field md:col-span-2">
            <label for="description" class="font-medium flex items-center gap-2">
              <span>Descripción</span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Una breve descripción sobre ti, tus habilidades e intereses (opcional)."></i>
            </label>
            <textarea id="description" pInputText formControlName="description" rows="3" class="w-full"
              placeholder="Una breve descripción sobre ti, tus habilidades e intereses..."></textarea>
            <small *ngIf="isInvalidField('description')" class="p-error">{{ getFieldError('description') }}</small>
          </div>

          <!-- Sección Académica -->
          <div class="md:col-span-2 mt-4">
            <h3 class="text-lg font-semibold border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">Datos Académicos</h3>
          </div>

          <div class="field">
            <label for="university" class="font-medium flex items-center gap-2">
              <span>Universidad <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="La institución educativa donde estudias o estudiaste."></i>
            </label>
            <select id="university" formControlName="university" class="w-full p-inputtext p-component mt-1">
              <option value="" disabled>Selecciona una universidad</option>
              <option *ngFor="let uni of universities" [value]="uni.value">{{ uni.label }}</option>
            </select>
            <small *ngIf="isInvalidField('university')" class="p-error">{{ getFieldError('university') }}</small>
          </div>

          <div class="field">
            <label for="career" class="font-medium flex items-center gap-2">
              <span>Carrera <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="El nombre de la carrera que estás cursando."></i>
            </label>
            <input id="career" type="text" pInputText formControlName="career" class="w-full mt-1" />
            <small *ngIf="isInvalidField('career')" class="p-error">{{ getFieldError('career') }}</small>
          </div>

          <div class="field">
            <label for="degreeStatus" class="font-medium flex items-center gap-2">
              <span>Estado de la Carrera <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Indica si estás cursando, si ya te graduaste o si has abandonado los estudios."></i>
            </label>
            <select id="degreeStatus" formControlName="degreeStatus" class="w-full p-inputtext p-component mt-1">
              <option value="" disabled>Selecciona un estado</option>
              <option *ngFor="let status of degreeStatuses" [value]="status.value">{{ status.label }}</option>
            </select>
            <small *ngIf="isInvalidField('degreeStatus')" class="p-error">{{ getFieldError('degreeStatus') }}</small>
          </div>

          <!-- Sección de Dirección -->
          <div class="md:col-span-2 mt-4">
            <h3 class="text-lg font-semibold border-b border-gray-200 dark:border-gray-700 pb-2 mb-4">Dirección</h3>
          </div>

          <div class="field">
            <label for="street" class="font-medium flex items-center gap-2">
              <span>Calle <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Nombre de la calle de tu domicilio."></i>
            </label>
            <input id="street" type="text" pInputText formControlName="street" class="w-full mt-1" />
            <small *ngIf="isInvalidField('street')" class="p-error">{{ getFieldError('street') }}</small>
          </div>

          <div class="field">
            <label for="number" class="font-medium flex items-center gap-2">
              <span>Número <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Altura de la calle."></i>
            </label>
            <input id="number" type="number" pInputText formControlName="number" class="w-full mt-1" />
            <small *ngIf="isInvalidField('number')" class="p-error">{{ getFieldError('number') }}</small>
          </div>

          <div class="field">
            <label for="postalCode" class="font-medium flex items-center gap-2">
              <span>Código Postal <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="Tu código postal."></i>
            </label>
            <input id="postalCode" type="text" pInputText formControlName="postalCode" class="w-full mt-1" pKeyFilter="int" />
            <small *ngIf="isInvalidField('postalCode')" class="p-error">{{ getFieldError('postalCode') }}</small>
          </div>

          <div class="field">
            <label for="city" class="font-medium flex items-center gap-2">
              <span>Ciudad <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="La ciudad de tu domicilio."></i>
            </label>
            <input id="city" type="text" pInputText formControlName="city" class="w-full mt-1" />
            <small *ngIf="isInvalidField('city')" class="p-error">{{ getFieldError('city') }}</small>
          </div>

          <div class="field md:col-span-2">
            <label for="province" class="font-medium flex items-center gap-2">
              <span>Provincia <span class="text-red-500">*</span></span>
              <i class="pi pi-info-circle cursor-pointer" pTooltip="La provincia de tu domicilio."></i>
            </label>
            <select id="province" formControlName="province" class="w-full p-inputtext p-component mt-1">
              <option value="" disabled>Selecciona una provincia</option>
              <option *ngFor="let prov of provinces" [value]="prov.value">{{ prov.label }}</option>
            </select>
            <small *ngIf="isInvalidField('province')" class="p-error">{{ getFieldError('province') }}</small>
          </div>

        </div>

        <div class="mt-8 flex flex-col md:flex-row justify-between items-center gap-4">
          <a routerLink="/auth/login" class="font-medium text-primary-600 hover:underline dark:text-primary-500 text-sm">
            ‹ Volver a Iniciar Sesión
          </a>
          <button pButton type="submit" label="Crear Cuenta" class="w-full md:w-auto" [disabled]="!form.valid || showModal()"></button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de Éxito -->
<div *ngIf="showModal()" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl text-center">
    <h2 class="text-2xl font-bold mb-4 text-green-500">{{ successMessage() }}</h2>
    <p class="text-gray-600 dark:text-gray-300">Serás redirigido en un momento...</p>
  </div>
</div>