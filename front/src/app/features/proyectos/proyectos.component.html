<p-toast></p-toast>
<div class="container">
  <div class="form-card">
    <div class="header">
      <img src="https://cdn-icons-png.flaticon.com/512/5956/5956592.png" alt="Proyect Logo" class="logo">
      <div class="user-icon">üë§</div>
    </div>

    <h2>Crear nuevo proyecto</h2>

    <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="projectName">Nombre del proyecto</label>
        <input type="text"
       id="projectName"
       placeholder="Ingres√° el nombre (3‚Äì80 caracteres)"
       maxlength="80"
       formControlName="name" />
      </div>

      <div class="form-group">
        <label for="projectDescription">Descripci√≥n</label>
        <textarea id="projectDescription"
          placeholder="Descripci√≥n del proyecto (10‚Äì500 caracteres)"
          maxlength="500"
          formControlName="description"></textarea>
      </div>
      <small class="error-text"
        *ngIf="projectForm.get('description')?.errors?.['server']">
        {{ projectForm.get('description')?.errors?.['server'] }}
      </small>

      <div class="form-group">
        <label for="budgetGoal">Meta de presupuesto (USD)</label>
        <input type="number" id="budgetGoal" placeholder="Ej: 150000" step="0.01" min="0" formControlName="budgetGoal" />
      </div>

      <div class="form-group">
        <label for="projectStatus">Estado</label>
        <select id="projectStatus" formControlName="status">
          <option value="" disabled>Seleccione un estado</option>
          <option value="PENDING_FUNDING">Financiamiento pendiente</option>
          <option value="IN_PROGRESS">En progreso</option>
          <option value="COMPLETED">Completado</option>
        </select>
      </div>

      <div class="form-group">
        <label for="startDate">Fecha de inicio</label>
        <input type="date" id="startDate" formControlName="startDate" />
      </div>

      <div class="form-group">
        <label for="estimatedEndDate">Fecha de finalizaci√≥n estimada</label>
        <input type="date" id="estimatedEndDate" formControlName="estimatedEndDate" />
      </div>
      <small class="error-text"
        *ngIf="projectForm.get('estimatedEndDate')?.errors?.['server']">
        {{ projectForm.get('estimatedEndDate')?.errors?.['server'] }}
      </small>

      <!-- Responsable -->
      <div class="form-group">
        <label for="owner">Responsable</label>
        <div class="p-input-icon-right w-full">
          <i *ngIf="ownerLoading" class="pi pi-spinner pi-spin"></i>
          <p-autoComplete
            inputId="owner"
            formControlName="owner"
            [dropdown]="true"
            [suggestions]="suggestionsOwners"
            (completeMethod)="completeOwner($event)"
            (onDropdownClick)="showAllOwners()"
            [minLength]="0"
            [forceSelection]="true"
            [appendTo]="'body'"
            [dataKey]="'id'"
            optionLabel="fullName">
          </p-autoComplete>
        </div>
        <small class="hint">Busc√° por nombre y eleg√≠ el responsable.</small>
      </div>

      <!-- Integrantes -->
      <div class="form-group">
        <label for="students">Estudiantes</label>
        <div class="p-input-icon-right w-full">
          <i *ngIf="studentsLoading" class="pi pi-spinner pi-spin"></i>
          <p-autoComplete
            inputId="students"
            formControlName="students"
            [multiple]="true"
            [dropdown]="true"
            [suggestions]="suggestionsStudents"
            (completeMethod)="completeStudents($event)"
            (onDropdownClick)="showAllStudents()"
            [minLength]="0"
            [delay]="200"
            [forceSelection]="true"
            [appendTo]="'body'"
            [dataKey]="'id'"
            optionLabel="fullName">
          </p-autoComplete>
        </div>
        <small class="hint">Agreg√° varios integrantes por nombre.</small>
      </div>

      <div class="actions">
        <button type="button" class="cancel-button" (click)="onCancel()">Cancelar</button>
        <button type="submit" class="create-button" [disabled]="projectForm.invalid || isLoading">Crear</button>
      </div>
    </form>

    <!-- Overlay de carga -->
    <div class="loading-overlay" *ngIf="isLoading">
      <div class="loading-content">
        <h3>Creando proyecto...</h3>
        <p>Por favor espere mientras se procesa la informaci√≥n.</p>
        <div class="progress-bar">
          <div class="progress-bar-fill" [style.width]="progress + '%'"></div>
        </div>
        <p class="progress-text">{{ progress }}%</p>
      </div>
    </div>
  </div>
</div>
